(()=>{var e={871:()=>{},670:()=>{}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";i.r(n),require("dotenv/config");const e=require("express");var t=i.n(e);const a=require("cookie-parser");var s=i.n(a);const r={main:{path:"/main"},signIn:{path:"/signin"},signUp:{path:"/signup"},profile:{path:"/profile"},forum:{path:"/forum"},topic:{path:"/topics/:id"},topicEdit:{path:"/topic/edit"},leaderboard:{path:"/leaderboard"},about:{path:"/about"},game:{path:"/game"},theme:{path:"/themes/:id"}},o=require("http-proxy-middleware");let l;!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.PATCH="PATCH",e.DELETE="DELETE"}(l||(l={}));const c="/api/v2";class u{constructor(e){var t,i;i=void 0,(t="base")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this.base=i,this.base=e?"/api/local":c}async request(e,t,i={}){return await fetch(`${this.base}/${t}`,{method:e,mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","Access-Control-Allow-Credentials":"true"},...e!==l.GET&&{body:JSON.stringify(i)}})??null}}const h=new u,d=new u(!0),m=(0,o.createProxyMiddleware)(c,{target:"https://ya-praktikum.tech",changeOrigin:!0,cookieDomainRewrite:"udg.nomoredomains.work"}),p=require("express-rate-limit"),g=i.n(p)()({windowMs:12e5,max:100}),y=require("react");var v=i.n(y);const w=require("react-dom/server"),f=require("react-router-dom"),b=require("react-redux"),E=require("react-helmet");var S=i.n(E);const x=require("redux"),C=require("redux-thunk");var O=i.n(C);const I=require("antd"),A=new class{isSuccessfulRequest(e,t){let i="Регистрация прошла успешно",n="Отправленные данные не корректны";switch(e.status){case 200:return t&&(i="signIn"===t?"Выполнен вход в приложение":"Выполнен выход из приложения"),I.notification.success({message:i}),!0;case 400:return"signIn"===t&&(n="Пользователь уже авторизован в системе"),I.notification.error({message:n}),!1;case 401:return I.notification.error({message:"Неверный логин или пароль"}),!1;case 500:return I.notification.error({message:"Произошла неизвестная ошибка"}),!1;default:return!1}}async signUp(e){const t=await h.request(l.POST,"auth/signup",e);return t&&this.isSuccessfulRequest(t)?(await t.json()).id??null:null}async signIn(e){const t=await h.request(l.POST,"auth/signin",e);return!!t&&this.isSuccessfulRequest(t,"signIn")}async logOut(){const e=await h.request(l.POST,"auth/logout");return!!e&&this.isSuccessfulRequest(e,"signOut")}async getUserInfo(){const e=await h.request(l.GET,"auth/user");return 200===e.status?await e.json()??null:null}};var _;!function(e){e.Common="Common",e.Password="Password"}(_||(_={}));const L=new class{isSuccessfulRequest(e,t){let i="Данные успешно изменены";switch(t&&(i=t===_.Common?"Данные профиля успешно изменены":"Пароль успешно изменен"),e.status){case 200:return I.notification.success({message:i}),!0;case 400:return I.notification.error({message:"Отправленные данные не корректны"}),!1;case 401:return I.notification.error({message:"Ошибка авторизации"}),!1;case 500:return I.notification.error({message:"Произошла неизвестная ошибка"}),!1;default:return!1}}async setProfile(e){const t={...e,display_name:""},i=await h.request(l.PUT,"user/profile",t);return i&&this.isSuccessfulRequest(i,_.Common)?await i.json()??null:null}async setPassword(e){const t=await h.request(l.PUT,"user/password",e);return!!t&&this.isSuccessfulRequest(t,_.Password)}async setAvatar(e){const t=await h.request(l.PUT,"user/avatar",e);return t&&this.isSuccessfulRequest(t)?await t.json()??null:null}},T="GET_PROFILE",P="SET_PASSWORD",k="PROFILE_LOADING",N=!("undefined"!=typeof window&&window.document&&window.document.createElement),R=e=>{if(!N){const t=document.cookie.match(new RegExp(`(?:^|; )${e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return t?decodeURIComponent(t[1]):void 0}return!1},D=()=>"true"===R("isSignedIn")||!1,U=e=>{document.cookie=`isSignedIn=${e.toString()}`},j=e=>{document.cookie=`setSignedInOAuth=${e.toString()}`},F=()=>R("userId")||"",q=e=>document.cookie=`userId=${e.toString()}`;let B;!function(e){e.INIT="init",e.LOADING="loading",e.DONE="done"}(B||(B={}));const M=e=>({type:k,payload:{isLoading:e}}),W=()=>async(e,t)=>{e(M(!0));try{const t=await A.getUserInfo();t?(e({type:T,payload:{data:t}}),q(t.id)):e(M(!1))}catch(t){e(M(!1))}},H={data:{id:0,second_name:"",first_name:"",email:"",phone:"",login:"",password:"",avatar:""},isLoading:!1,stage:B.INIT},z="SIGN_IN",G="SIGN_IN_OAUTH",K="SIGN_OUT",$="LOADING";let V;!function(e){e.INIT="init",e.LOADING="loading",e.DONE="done"}(V||(V={}));const J=e=>({type:$,payload:{isLoading:e}}),Q=()=>({type:z}),X=()=>({type:K}),Z={isSignedIn:D(),isSignedInOAuth:D(),isLoading:!1,stage:V.INIT},Y="SET_THEME",ee="TOPIC_LOAD",te="TOPIC_SET_LOADING",ie={isLoading:!1,data:{id:0,title:"",body:"",created_at:"",user_id:0,comments_count:null}},ne="LOAD_LEADERBOARD",ae="SET_LOADING_LEADERBOARD",se={isLoading:!1,data:[]},re="LOAD_FORUM",oe="SET_LOADING_FORUM",le={isLoading:!1,data:[]},ce=(0,x.combineReducers)({auth:(e=Z,t)=>{switch(t.type){case z:return{isSignedIn:!0,isSignedInOAuth:!1,isLoading:!1,stage:V.DONE};case G:return{isSignedIn:!1,isSignedInOAuth:!0,isLoading:!1,stage:V.DONE};case K:return{isSignedIn:!1,isSignedInOAuth:!1,isLoading:!1,stage:V.DONE};case $:return{isSignedIn:!1,isSignedInOAuth:!1,isLoading:t.payload.isLoading,stage:V.LOADING};default:return e}},profile:(e=H,t)=>{switch(t.type){case T:case"SET_PROFILE":return{data:{...t.payload.data},isLoading:!1,stage:B.DONE};case P:return{...e,isLoading:!1,stage:B.DONE};case k:return{data:{},isLoading:t.payload.isLoading,stage:B.LOADING};default:return e}},leaderBoard:(e=se,t)=>{switch(t.type){case ne:return{...e,data:t.payload.data};case ae:return{...e,isLoading:t.payload.isLoading};default:return e}},theme:(e=null,t)=>t.type===Y?t.payload:e,forum:(e=le,t)=>{switch(t.type){case re:return{...e,data:t.payload.data};case oe:return{...e,isLoading:t.payload.isLoading};default:return e}},topic:(e=ie,t)=>{switch(t.type){case ee:return{...e,data:t.payload.data};case te:return{...e,isLoading:t.payload.isLoading};default:return e}}}),ue=N?{}:window.__INITIAL_STATE__;class he extends y.Component{constructor(e){super(e),this.state={error:null,errorInfo:null}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.error?v().createElement("h2",null,"Something went wrong!"):this.props.children}}const de=he,me=({isActive:e,children:t,title:i})=>v().createElement(I.Modal,{className:"xIdsnPhxwe4Zq0BRMNiF",title:i,visible:e,footer:null,closable:!1},v().createElement("div",{className:"ultcbUs8Qt8tCIj5tXOH"},t)),pe={providerURLRoot:"https://oauth.yandex.ru/authorize?response_type=code",redirectURI:"https://udg.nomoredomains.work",serviceId:"oauth/yandex/service-id",signIn:"oauth/yandex",udcClientId:"b7aa7e3038ed42358ea3cd11acddef45"},{serviceId:ge,signIn:ye,redirectURI:ve}=pe,we=new class{isSuccessfulRequest(e,t){switch(e.status){case 200:return t&&I.notification.success({message:"Вход выполнен успешно"}),!0;case 400:return I.notification.error({message:"Отправленные данные не корректны"}),!1;case 401:return I.notification.error({message:"Ошибка доступа"}),!1;case 500:return I.notification.error({message:"Произошла неизвестная ошибка"}),!1;default:return!1}}async getServiceId(e){const t=await h.request(l.GET,ge,e);return t&&this.isSuccessfulRequest(t)?(await t.json()).service_id??null:null}async signUpWithYandex(e){const t=await h.request(l.POST,ye,{code:e,redirect_uri:ve});return!!t&&this.isSuccessfulRequest(t,!0)}},fe=e=>{(0,y.useEffect)(e,[])},be=require("@ant-design/icons"),Ee=({children:e})=>v().createElement("div",{className:"kJXI1z3_FtxH2idolQUx"},e),Se=(e="")=>e.replace(/<\/?.+?>/gi,""),xe=e=>{const{title:t,description:i,image:n}=(({title:e,description:t,image:i})=>({title:Se(e),description:Se(t).substr(0,250),image:i}))(e);return v().createElement(S(),null,v().createElement("title",null,t),v().createElement("meta",{property:"og:title",content:t}),v().createElement("meta",{property:"twitter:title",content:t}),Boolean(i)&&v().createElement("meta",{name:"description",content:i}),Boolean(i)&&v().createElement("meta",{property:"og:description",content:i}),Boolean(i)&&v().createElement("meta",{property:"twitter:description",content:i}),Boolean(n)&&v().createElement("meta",{property:"og:image",content:n}))};function Ce(){return Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Ce.apply(this,arguments)}const{Password:Oe}=I.Input,Ie=e=>v().createElement(Oe,Ce({prefix:v().createElement(be.LockOutlined,null),iconRender:()=>!1},e)),Ae=e=>v().createElement(I.Button,e),_e=b.useSelector,Le={container:"mTFHSVjnSUFdoSnWwGhe",logo:"AQj0qjGusBKgpXIQViBm",logoMainSymbol:"aNbRr60ArYUg5LfoQFU1",buttonContainer:"zVYRLMeG9dFBljEerzGQ",routesContainer:"XUShHu6oinx4l6jUlqoK",signUp:"HEQhGHtynWtNqUFywT1T",signIn:"AprMwPhjHqR_T2NfcvnM"},Te=e=>v().createElement(I.Switch,e),Pe=new class{async getTheme(e){const t=await d.request(l.GET,`themes/${e}`);return 200===t.status?await t.json()??null:null}async updateTheme(e,t){const i=await d.request(l.PUT,`themes/${e}`,{theme:t});return 200===i.status?await i.json()??null:null}async createTheme(e){const t=await d.request(l.POST,"themes",e);return 200===t.status?await t.json()??null:null}},ke="light",Ne="dark",Re=e=>{e===Ne?document.body.classList.remove(ke):e===ke&&document.body.classList.remove(Ne),document.body.classList.add(e)},De=e=>({type:Y,payload:e}),Ue=e=>async(t,i)=>{const n=F(),a=(await Pe.updateTheme(n,e))?.theme||ke;t(De(a)),Re(a)},je=({currentPath:e})=>{const t=_e((e=>e.auth.isSignedIn)),i=_e((e=>e.auth.isSignedInOAuth)),[n,a]=(0,y.useState)([]),{theme:s,changeTheme:o}=(()=>{const e=(0,b.useDispatch)();return{theme:_e((e=>e.theme)),changeTheme:t=>{e("light"===t?Ue("dark"):"dark"===t?Ue("light"):async(e,t)=>{const i=F(),n=await Pe.createTheme({theme:"dark",user_id:i}),a=n?.theme||ke;e(De(a)),n&&Re(a)})}}})(),l=[{path:r.profile.path,label:"Профиль"},{path:r.leaderboard.path,label:"Таблица лидеров"},{path:r.forum.path,label:"Форум"},{path:r.signUp.path,label:"Регистрация"},{path:r.signIn.path,label:"Вход"}];return fe((()=>{a(t||i?l.filter((e=>e.path!==r.signUp.path&&e.path!==r.signIn.path)):l.filter((e=>e.path===r.signUp.path||e.path===r.signIn.path)))})),v().createElement("nav",{className:"FGIBGaQePsS7MPrLD6AI"},v().createElement("ul",{className:"VhefOyE6KqL2INmTvax_"},n.map((t=>v().createElement("li",{className:t.path===e?"eb4qUgSDxGoiL722sZWU":"FeWI55JQiPAKhK8Rt5kQ",key:t.path},v().createElement(f.Link,{to:t.path},t.label)))),(t||i)&&v().createElement(Te,{onClick:()=>o(s)})))},{Text:Fe}=I.Typography,qe=({currentPath:e})=>{const{renderSignOutButton:t}=(()=>{const e=(0,f.useHistory)(),t=(0,b.useDispatch)(),i=(0,y.useCallback)((async i=>{i.preventDefault(),t((e=>async(t,i)=>{t(J(!0)),U(!1),j(!1),q(0),e.push(r.signIn.path);try{t(await A.logOut()?X():J(!1))}catch(e){t(J(!1))}})(e))}),[]);return{renderSignOutButton:()=>v().createElement(Ae,{onClick:i},"Выйти")}})(),i=_e((e=>e.auth.isSignedIn)),n=_e((e=>e.auth.isSignedInOAuth));return v().createElement("div",{className:Le.container},v().createElement("div",{className:Le.logo},v().createElement(f.Link,{to:r.main.path,className:Le.logoSymbols},v().createElement("span",{className:Le.logoMainSymbol},"U"),v().createElement(Fe,{type:"secondary"},"DC"))),v().createElement("div",{className:Le.routesContainer},v().createElement(je,{currentPath:e}),v().createElement("div",{className:Le.buttonContainer},(i||n)&&t())))},Be=({isSpinning:e,children:t})=>{const i=v().createElement(be.LoadingOutlined,{style:{fontSize:72},spin:!0});return v().createElement(v().Fragment,null,v().createElement(I.Spin,{className:"kySekU_9UevbfgBcgQyY",indicator:i,size:"large",spinning:e}),v().createElement("div",{className:e?"E504S1U9EEZmM5IH4xUx":"NK4oWEno3OTBZGk14ybv"},t))};let Me;!function(e){e.Login="login",e.Password="password"}(Me||(Me={}));const{providerURLRoot:We,redirectURI:He,udcClientId:ze}=pe,Ge=()=>{const e=(0,y.useCallback)((async()=>{window.location.replace(`${We}&client_id=${ze}\n&redirect_uri=${He}`)}),[]);return v().createElement(Ae,{className:"yHwKfZYQBg7DNphUOjwh",onClick:e},v().createElement(be.LoginOutlined,{className:"tsI5LJ1GqWtO8I4zgmyX"}),"Войти через Яндекс")},Ke=()=>{const{onFinish:e,onFinishFailed:t,isLoading:i}=(()=>{const e=(0,f.useHistory)(),t=(0,b.useDispatch)(),i=_e((e=>e.auth.isLoading)),n=(0,y.useCallback)((async i=>{t(((e,t)=>async(i,n)=>{i(J(!0));try{await A.signIn(e)?(i(Q()),U(!0),t.push(r.main.path)):i(J(!1))}catch(e){i(J(!1))}})(i,e))}),[]);return{currentPath:r.signIn.path,onFinish:n,onFinishFailed:e=>console.log("Failed:",e),isLoading:i}})();return v().createElement(Be,{isSpinning:i},v().createElement(Ee,null,v().createElement(xe,{title:"SignIn",description:"SignIn page"}),v().createElement(qe,{currentPath:r.signIn.path}),v().createElement("div",{className:"C9kTxACIRCoIHh4xS7yE"},v().createElement(I.Form,{name:"signIn",onFinish:e,onFinishFailed:()=>t,layout:"vertical"},v().createElement(I.Form.Item,{name:Me.Login,rules:[{required:!0,message:"Введите логин"}]},v().createElement(I.Input,{placeholder:"логин",prefix:v().createElement(be.UserOutlined,null)})),v().createElement(I.Form.Item,{name:Me.Password,rules:[{required:!0,message:"Введите пароль"}]},v().createElement(Ie,{placeholder:"пароль"})),v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,type:"primary",htmlType:"submit"},"Войти")),v().createElement(I.Form.Item,null,v().createElement(Ge,null))))))};var $e;!function(e){e.SecondName="second_name",e.FirstName="first_name",e.Email="email",e.Phone="phone",e.Login="login",e.Password="password"}($e||($e={}));const Ve=()=>{const{fieldSet:e,onFinish:t,onFinishFailed:i}=(()=>{const e=(0,f.useHistory)(),t=[{name:$e.SecondName,rules:[{required:!0,message:"Введите фамилию"}],placeholder:"Фамилия"},{name:$e.FirstName,rules:[{required:!0,message:"Введите имя"}],placeholder:"Имя"},{name:$e.Email,rules:[{required:!0,message:"Введите почту"}],placeholder:"Эл. почта"},{name:$e.Phone,rules:[{required:!0,message:"Введите телефон"}],placeholder:"Телефон"},{name:$e.Login,rules:[{required:!0,message:"Введите логин"}],placeholder:"Логин"},{name:$e.Password,rules:[{required:!0,message:"Введите пароль"}],placeholder:"Пароль",type:"password"}];return{currentPath:r.signUp.path,fieldSet:t,onFinish:async t=>{await A.signUp(t)&&e.push(r.signIn.path)},onFinishFailed:e=>console.log("Failed:",e)}})();return v().createElement(Ee,null,v().createElement(qe,{currentPath:r.signUp.path}),v().createElement("div",{className:"_4r4fQwgzOuwIOzlNjdva"},v().createElement(I.Form,{name:"signUp",onFinish:t,onFinishFailed:()=>i,layout:"vertical"},e.map(((e,t)=>v().createElement(I.Form.Item,{name:e.name,rules:e.rules,key:`${e.name}-${t}`},v().createElement(I.Input,{type:e.type??"",placeholder:e.placeholder})))),v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,type:"primary",htmlType:"submit"},"Зарегистрироваться")))))},Je={container:"pAZsGDSIwHLk6FyMvuHq",infoContainer:"SCceGicoKjZbSFCUBNKH",title:"jmDUZnAIerxVoLf7HHyx",titleMain:"DSp6h4AcHxJnmSxh5kSL",info:"oautDfGR7aAKuM_pwWJO",gameHref:"cXj9rBw90d6eB9h24ZiA"},{Text:Qe}=I.Typography,Xe=()=>{const{title:e,info:t,infoContainer:i,container:n}=Je,a=(0,b.useDispatch)();return fe((()=>{a(W())})),v().createElement(Ee,null,v().createElement(xe,{title:"Main",description:"Main page"}),v().createElement(qe,null),v().createElement("div",{className:n},v().createElement("div",{className:i},v().createElement(I.Typography,{className:e},v().createElement("span",{className:Je.titleMain},"Ultimate"),v().createElement(Qe,{type:"secondary"}," Dungeon Crawler")),v().createElement(I.Typography,{className:t},"Очисти некогда великую обитель от насилия монстров и заблудших душ"),v().createElement(f.Link,{to:r.game.path},v().createElement(I.Button,{type:"primary"},"Играть")))))},Ze=require("antd/lib/form/Form"),Ye=[{name:"first_name",disabled:!0,required:!1,placeholder:"Имя",component:I.Input},{name:"second_name",disabled:!0,required:!1,placeholder:"Фамилия",component:I.Input},{name:"email",disabled:!0,required:!0,message:"Введите эл. почту",placeholder:"Эл. почта",component:I.Input},{name:"phone",disabled:!0,required:!1,placeholder:"Телефон",component:I.Input},{name:"login",disabled:!0,required:!0,message:"Введите логин",placeholder:"Логин",component:I.Input}],et=[{name:"oldPassword",disabled:!0,required:!1,message:"Введите старый пароль",placeholder:"Старый пароль",component:Ie},{name:"newPassword",disabled:!0,required:!1,message:"Введите новый пароль",placeholder:"Новый пароль",component:Ie}],tt=()=>{const[e,t]=(0,y.useState)(!1),[i,n]=(0,y.useState)(!1),[a]=(0,Ze.useForm)(),s=(0,b.useDispatch)(),{data:o,isLoading:l}=_e((e=>e.profile),b.shallowEqual);fe((()=>{s(W()),n("true"===R("setSignedInOAuth")||!1)})),(0,y.useEffect)((()=>{a.setFieldsValue(o)}),[a,o]);const c=(0,y.useCallback)((e=>{const{oldPassword:t,newPassword:i,...n}=e;s((e=>async(t,i)=>{t(M(!0));try{const i=await L.setProfile(e);t(i?(e=>({type:T,payload:{data:e}}))(i):M(!1))}catch(e){t(M(!1))}})(n)),t&&i&&s((e=>async(t,i)=>{t(M(!0));try{t(await L.setPassword(e)?{type:P}:M(!1))}catch(e){t(M(!1))}})({oldPassword:t,newPassword:i}))}),[]),u=(0,y.useCallback)((e=>console.log("Failed:",e)),[]);return{currentPath:r.profile.path,onFinish:c,onFinishFailed:u,isEdit:e,setIsEdit:t,isOAuthSigned:i,profile:o,form:a,fields:Ye,passwordFields:et,isLoading:l}},it=(e,t)=>e.map(((e,i)=>{const{component:n,name:a,message:s,required:r,disabled:o,placeholder:l}=e;return v().createElement(I.Form.Item,{key:`item-${i}`,name:a,rules:[{required:r,message:s}]},v().createElement(n,{disabled:o&&!t,placeholder:l}))})),nt=({isEdit:e})=>{const{fields:t,passwordFields:i}=tt();return v().createElement(v().Fragment,null,it(t,e),e&&it(i,e))},at=({isEdit:e,setIsEdit:t,onFinish:i,form:n})=>{const a=(0,y.useCallback)((()=>{t(!e),n.resetFields()}),[n,e]),s=(0,y.useCallback)((()=>{t(!e)}),[e]);return e?v().createElement(v().Fragment,null,v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,type:"primary",onClick:()=>{I.Modal.confirm({title:"Сохранить?",content:"Будут изменены данные профиля",cancelText:"Нет",okText:"Да",onOk(){t(!1),i(n.getFieldsValue(!0))},onCancel(){t(!1),n.resetFields()}})}},"Сохранить",v().createElement(be.EditOutlined,null))),v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,className:"XcpXT3fVczqQykjGsWKX",type:"default",onClick:a},"Отменить"))):v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,type:"primary",onClick:s},"Редактировать",v().createElement(be.EditOutlined,null)))};var st=i(871),rt=i.n(st);const ot=()=>{const{currentPath:e,onFinish:t,isEdit:i,setIsEdit:n,isOAuthSigned:a,profile:s,form:r,isLoading:o}=tt();return v().createElement(Be,{isSpinning:o},v().createElement(Ee,null,v().createElement(xe,{title:"Profile",description:"Profile page"}),v().createElement(qe,{currentPath:e}),v().createElement("div",{className:"NeTQGkuyOTT60EAvRHMH"},v().createElement(I.Space,{className:"nNNqd4uYzsCMlqnKPxLF",direction:"vertical",size:"middle"},s.avatar&&v().createElement(I.Image,{width:200,height:200,src:`api/v2/resources${s.avatar}`,crossOrigin:"use-credentials",fallback:rt()}),!s.avatar&&v().createElement("div",{className:"qGDfz5gGyncaGneQYXco"}),v().createElement(I.Form,{name:"profile",form:r,initialValues:s,layout:"vertical"},v().createElement(nt,{isEdit:i}),!a&&v().createElement(at,{isEdit:i,setIsEdit:n,form:r,onFinish:t}))))))},lt={tableContainer:"h4pJAZ6ZYAtiycUJJW3g",title:"S_BnvX9K7zmCBzCnTxlY",counter:"Vu0ebY7tJswaf1LhSZfy",buttonContainer:"Z90jr4hKQ5ZF2P5MiEzw"},ct="topics",ut=new class{isSuccessfulRequest(e){switch(e.status){case 200:case 201:return!0;case 400:return I.notification.error({message:"Отправленные данные не корректны"}),!1;case 401:return I.notification.error({message:"Ошибка авторизации"}),!1;case 500:return I.notification.error({message:"Произошла неизвестная ошибка"}),!1;default:return!1}}async getTopics(){const e=await d.request(l.GET,ct);return e&&this.isSuccessfulRequest(e)?await e.json()??[]:[]}async getTopic(e){const t=await d.request(l.GET,`topics/${e}`);return t&&this.isSuccessfulRequest(t)?await t.json()??null:null}async createTopic(e){const t=await d.request(l.POST,ct,e);return!(!t||!this.isSuccessfulRequest(t))&&await t.json()}async updateTopic(e,t){const i=await d.request(l.PUT,`topics/${e}`,t);return i&&this.isSuccessfulRequest(i)?await i.json()??null:null}},ht=e=>({type:oe,payload:{isLoading:e}}),dt=()=>{const{data:e,isLoading:t,table:i,history:n}=(()=>{const e=(0,b.useDispatch)(),t=(0,f.useHistory)(),i=(0,y.useRef)(null),{data:n,isLoading:a}=_e((e=>e.forum),b.shallowEqual);return fe((()=>{e((async(e,t)=>{e(ht(!0));try{const t=await ut.getTopics();t&&e((e=>({type:re,payload:{data:e}}))(t)),e(ht(!1))}catch(t){e(ht(!1))}}))})),{data:n,isLoading:a,table:i,history:t}})(),a=[{title:"Заголовок",dataIndex:["data","title"],render:(e,t)=>v().createElement("div",{className:lt.title},t?.title)},{title:"Кол-во сообщений",dataIndex:["data","messagesCount"],render:(e,t)=>v().createElement("div",{className:lt.counter},t?.comments_count??0)},{title:"Действия"}],s=(0,y.useCallback)((e=>({onClick:()=>n.push(r.topic.path.replace(":id",e?.id.toString()))})),[]),o=(0,y.useCallback)((e=>e?.id),[]),l=(0,y.useCallback)((()=>n.push(r.topicEdit.path)),[]);return v().createElement(Ee,null,v().createElement(xe,{title:"Forum",description:"Game forum"}),v().createElement(qe,{currentPath:r.forum.path}),v().createElement("div",{className:lt.tableContainer},v().createElement(I.Table,{ref:i,className:lt.leaderBoardTable,columns:a,dataSource:e,rowKey:o,onRow:s,loading:{size:"large",spinning:t},scroll:{y:400},pagination:!1})),v().createElement("div",{className:lt.buttonContainer},v().createElement(Ae,{type:"primary",onClick:l},"Создать")))},mt=()=>v().createElement(Ee,null,v().createElement(xe,{title:"About",description:"About game"}),v().createElement(qe,{currentPath:r.about.path})),pt="southParkGameScore",gt=new class{async getLeaderBoard(e){const t={ratingFieldName:pt,cursor:e,limit:10},i=await h.request(l.POST,"leaderboard/all",t);return i.ok?await i.json()??null:(i.status>=400&&i.status,i.status>=500&&I.notification.error({message:"Не удалось получить данные лидерборда"}),null)}async createLeaderBoardRecord(e){const t={data:e,ratingFieldName:pt,teamName:"southpark"},i=await h.request(l.POST,"leaderboard",t);return i.ok?(I.notification.success({message:"Рекорд сохранен"}),!0):(i.status>=400&&i.status<500&&I.notification.error({message:"Не удалось сохранить рекорд"}),i.status>=500&&I.notification.error({message:"Не удалось сохранить рекорд"}),null)}},yt=e=>({type:ae,payload:{isLoading:e}}),vt=e=>async(t,i)=>{t(yt(!0));try{const i=await gt.getLeaderBoard(e);i&&t((e=>({type:ne,payload:{data:e}}))(i)),t(yt(!1))}catch(e){t(yt(!1))}},wt=e=>v().createElement("div",{className:"shyebdQ7V79WnyJEEzeC"},v().createElement(I.Button,{type:"default",icon:v().createElement(be.LeftOutlined,null),onClick:e.onMoveLeft,disabled:!e.canMoveLeft}),v().createElement(I.Button,{className:"bCl2fYvnr1euix4tqdmM",type:"default",icon:v().createElement(be.RightOutlined,null),onClick:e.onMoveRight,disabled:!e.canMoveRight})),ft=[{title:"Логин",dataIndex:["data","login"],render:(e,t)=>{const i=t.data[pt];return v().createElement("div",{className:"HcjLexU_ULLT64Fy5m_N "+(i>100?"A9tTBCkPNUB1VMe4nsR2":"SyFk3md3WBR2rgiLvKh5")},e)}},{title:"Очки",dataIndex:["data",pt]}],bt=(e,t,i,n)=>{console.log("params",e,t,i,n)},Et=()=>{const{data:e,isLoading:t,canMoveLeft:i,onMoveLeft:n,canMoveRight:a,onMoveRight:s,table:o,tableScroll:l}=(()=>{const[e,t]=(0,y.useState)(!1),[i,n]=(0,y.useState)(!1),[a,s]=(0,y.useState)(0),r=(0,b.useDispatch)(),o=(0,y.useRef)(null),[l,c]=(0,y.useState)(N?0:window?.innerHeight),{data:u,isLoading:h}=_e((e=>e.leaderBoard),b.shallowEqual);fe((()=>{if(r(vt(a)),o.current){const e=o.current.clientHeight,t=o.current.getElementsByClassName("ant-table-header"),i=t.length?t[0].clientHeight:0;c(e-i)}})),(0,y.useEffect)((()=>{const e=u.length>=10;n(e),t(0!==a)}),[u]);const d=(0,y.useCallback)((()=>{const e=a+10;s(e),r(vt(e))}),[u]),m=(0,y.useCallback)((()=>{const e=a-10;s(e),r(vt(e))}),[u]);return{data:u,isLoading:h,canMoveLeft:e,onMoveLeft:m,canMoveRight:i,onMoveRight:d,table:o,tableScroll:l}})(),c=(0,y.useCallback)((e=>e.data.login),[]);return v().createElement(Ee,null,v().createElement(xe,{title:"Leaderboard",description:"Leaderboard page"}),v().createElement(qe,{currentPath:r.leaderboard.path}),v().createElement("div",{className:"VNtOnQ9u1eqRD7cD6rL3"},v().createElement(I.Table,{ref:o,className:"L3SZByFwQnpU08n5SPsJ",columns:ft,dataSource:e,onChange:bt,rowKey:c,loading:{size:"large",spinning:t},scroll:{y:l},pagination:!1})),v().createElement(wt,{onMoveLeft:n,canMoveLeft:i,onMoveRight:s,canMoveRight:a,isLoading:t}))},St={title:"ZysAcaq2wqNhjy8Izjfx",info:"OdAUtezfXOkkacFZbGNV",notFound:"_oqEYBV8I5tzU_K4b01Q",container:"hvuBUQ5BuCflJ3z7EgLb",errorContainer:"a9XtgsE_WJB8ErZLTHBl",back:"H7clTc6gQPwiqxfv0oHg"},xt={404:"Страница не существует",403:"Доступ закрыт",500:"Неизвестная ошибка"},Ct=({status:e="404"})=>{const{container:t,errorContainer:i,title:n,info:a,back:s,notFound:o}=St;return v().createElement(Ee,null,v().createElement("div",{className:t},v().createElement("div",{className:i},v().createElement(I.Typography,{className:n},e),v().createElement(I.Typography,{className:a},xt[e]),v().createElement(f.Link,{to:"403"===e?r.signIn.path:r.main.path,className:s},"Вернуться")),v().createElement("div",{className:o})))};function Ot(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let It;!function(e){e.Rectangle="Rectangle",e.Circle="Circle",e.Shape="Shape"}(It||(It={}));const At=function(){let e=0;return()=>(e+=1,e)}(),_t=16,Lt=1/60;let Tt,Pt;function kt(e){return e.hasOwnProperty("canCollide")}!function(e){e.ArrowLeftDown="ArrowLeftDown",e.ArrowTopDown="ArrowTopDown",e.ArrowBottomDown="ArrowBottomDown",e.ArrowRightDown="ArrowRightDown",e.ArrowLeftUp="ArrowLeftUp",e.ArrowTopUp="ArrowTopUp",e.ArrowBottomUp="ArrowBottomUp",e.ArrowRightUp="ArrowRightUp",e.SpaceDown="SpaceDown",e.SpaceUp="SpaceUp",e.Resize="Resize"}(Tt||(Tt={})),function(e){e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowDown="ArrowDown",e.ArrowRight="ArrowRight",e.Space=" "}(Pt||(Pt={}));const Nt=new class{hasBox2DCollided(e,t){e.geometry.calculateBoundingBox(e),t.geometry.calculateBoundingBox(t);const i=e.geometry.boundingBox,n=t.geometry.boundingBox;return i.min.x<n.max.x&&i.max.x>n.min.x&&i.min.y<n.max.y&&i.max.y>n.min.y}getNewPositionAfterWallCollision(e,t,i,n){const a=e.geometry,s=t.geometry.boundingBox,{isMovingRight:r,isMovingLeft:o,isMovingDown:l,isMovingTop:c}=i.moveState,u=e.position.copy(),h=Lt*i.speed;if(r){if(e.position=n.copy(),e.position.x+=h,this.hasBox2DCollided(e,t))return e.position.x=t.position.x-a.width,e.position.y=u.y,e.position;e.position=u}if(l){if(e.position=n.copy(),e.position.y+=h,this.hasBox2DCollided(e,t))return e.position.x=u.x,e.position.y=s.min.y-a.height,e.position;e.position=u}if(o){if(e.position=n.copy(),e.position.x-=h,this.hasBox2DCollided(e,t))return e.position.x=s.max.x,e.position.y=u.y,e.position;e.position=u}if(c){if(e.position=n.copy(),e.position.y-=h,this.hasBox2DCollided(e,t))return e.position.x=u.x,e.position.y=s.max.y,e.position;e.position=u}return e.position}};function Rt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Dt{constructor(e){if(Rt(this,"canvas",void 0),Rt(this,"context",void 0),!e.canvas)throw new Error("Ошибка инициализации");const t=e.canvas.getContext("2d");if(!t)throw new Error("Ошибка получения контекста канвас");this.canvas=e.canvas,this.context=t,this.init(e.width,e.height)}init(e,t){this.canvas.width=e,this.canvas.height=t}render(e,t){const i=this.context,{canvas:n}=this,{background:a}=e;i.clearRect(0,0,n.width,n.height),i.fillStyle=`rgba(${a.r}, ${a.g}, ${a.b}, ${a.a})`,i.fillRect(0,0,n.width,n.height);for(const i of e.objects)i.geometry.type===It.Rectangle&&this._drawRectangle(i,t)}prerender(e){for(const t of e.objectWithPhysics)t.updateState();for(let t=0;t<e.objectWithPhysics.length;t+=1)for(let i=t+1;i<e.objectWithPhysics.length;i+=1){const n=e.objectWithPhysics[t],a=e.objectWithPhysics[i];kt(n)&&kt(a)&&Nt.hasBox2DCollided(n,a)&&(n.onCollide(a),a.onCollide(n))}}_drawRectangle(e,t){if(!e.visible)return;const i=this.context,n=e.geometry,{color:a}=e,s=this.canvas.width/t.size,{x:r,y:o,width:l,height:c}=this._recalculateWorldValuesToCanvasValues(t,{x:e.position.x,y:e.position.y,width:n.width,height:n.height});if(i.translate(r,o),e.spriteConfig?.shouldFlip&&(i.translate(l,0),i.scale(-1,1)),e.rotation&&e.rotationCenter&&(i.translate(e.rotationCenter.x*s,e.rotationCenter.y*s),i.rotate(e.rotation),i.translate(-e.rotationCenter.x*s,-e.rotationCenter.y*s)),e.spriteConfig?.image){const t=e.spriteConfig.sprite,n=e.spriteConfig.image;i.drawImage(n,t.sx,t.sy,t.sWidth,t.sHeight,0,0,l,c)}else i.fillStyle=`rgba(${a.r}, ${a.g}, ${a.b}, ${a.a})`,i.fillRect(0,0,l,c);i.setTransform(1,0,0,1,0,0)}_recalculateWorldValuesToCanvasValues(e,t){e.bindedObject&&(t.x=e.size/2+(t.x-e.bindedObject.position.x),t.y=e.size/2+(t.y-e.bindedObject.position.y));const i=this.canvas.width/e.size;return t.x*=i,e.bindedObject?t.y=i*t.y-(e.size/2*i-this.canvas.height/2):t.y*=i,t.width*=i,t.height*=i,t}}function Ut(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class jt{constructor(e,t,i,n=1){Ut(this,"r",void 0),Ut(this,"g",void 0),Ut(this,"b",void 0),Ut(this,"a",void 0),this.r=e,this.g=t,this.b=i,this.a=n}}function Ft(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class qt{constructor(e,t){Ft(this,"min",void 0),Ft(this,"max",void 0),this.min=e,this.max=t}}function Bt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Mt{constructor(e,t){Bt(this,"x",void 0),Bt(this,"y",void 0),this.x=e,this.y=t}add(e){return this.x+=e.x,this.y+=e.y,this}rotateAround(e,t){return this.x=Math.cos(t)*(this.x-e.x)-Math.sin(t)*(this.y-e.y)+e.x,this.y=Math.sin(t)*(this.x-e.x)+Math.cos(t)*(this.y-e.y)+e.y,this}copy(){return new Mt(this.x,this.y)}}function Wt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ht extends class{constructor(e){Ot(this,"id",void 0),Ot(this,"name",void 0),Ot(this,"boundingBox",void 0),Ot(this,"boundingCircle",void 0),Ot(this,"type",void 0),this.id=At(),this.name="",this.type=e.geomType,this.boundingBox=null,this.boundingCircle=null}calculateBoundingBox(e){}calculateBoundingCircle(e){}}{constructor(e,t){super({geomType:It.Rectangle}),Wt(this,"width",void 0),Wt(this,"height",void 0),this.width=e,this.height=t}calculateBoundingBox(e){this.boundingBox||(this.boundingBox=new qt(new Mt(0,0),new Mt(0,0)));const t=new Mt(this.width,this.height),{position:i}=e;if(e.rotation&&e.rotationCenter){let t=e.rotation;e.spriteConfig?.shouldFlip&&(t=-t);const i=e.rotationCenter.copy().add(new Mt(e.position.x,e.position.y)),n=new Mt(e.position.x,e.position.y),a=new Mt(e.position.x,e.position.y+this.height),s=new Mt(e.position.x+this.width,e.position.y),r=new Mt(e.position.x+this.width,e.position.y+this.height);n.rotateAround(i,t),a.rotateAround(i,t),s.rotateAround(i,t),r.rotateAround(i,t);const o=Math.min(n.x,a.x,s.x,r.x),l=Math.max(n.x,a.x,s.x,r.x),c=Math.min(n.y,a.y,s.y,r.y),u=Math.max(n.y,a.y,s.y,r.y),h=new Mt(o,c),d=new Mt(l,u);this.boundingBox=new qt(h,d)}else this.boundingBox.min=i,this.boundingBox.max=i.copy().add(t)}}function zt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Gt{constructor(e){zt(this,"background",void 0),zt(this,"objects",void 0),zt(this,"objectWithPhysics",void 0),this.objects=[],this.objectWithPhysics=[],this.background=e||new jt(255,255,255)}add(e){Array.isArray(e)?this.objects.push(...e):this.objects.push(e)}addObjectWithPhysics(e){Array.isArray(e)?this.objectWithPhysics.push(...e):this.objectWithPhysics.push(e)}remove(e){this.objects=this.objects.filter((t=>t!==e)),this.objectWithPhysics=this.objectWithPhysics.filter((t=>t!==e))}}function Kt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const $t=function(){let e=0;return()=>e+=1}();class Vt{constructor(e){Kt(this,"id",void 0),Kt(this,"name",void 0),Kt(this,"position",void 0),Kt(this,"rotation",void 0),Kt(this,"rotationCenter",void 0),Kt(this,"visible",void 0),Kt(this,"frustumCulled",void 0),Kt(this,"userData",void 0),Kt(this,"geometry",void 0),Kt(this,"color",void 0),Kt(this,"spriteConfig",void 0),this.id=$t(),this.name="",this.position=new Mt(0,0),this.visible=!0,this.frustumCulled=!1,this.userData=null,this.spriteConfig=null,this.geometry=e.geometry,this.color=e.color||new jt(0,0,0)}move(e){this.position.add(e)}rotateAround(e,t){this.rotation=t,this.rotationCenter=new Mt(e.x-this.position.x,e.y-this.position.y)}scale(){}updateState(){}}class Jt{}function Qt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Xt extends Jt{constructor(e){super(),Qt(this,"moveState",void 0),Qt(this,"speed",void 0),this.speed=e.speed,this.moveState={isMovingLeft:!1,isMovingRight:!1,isMovingTop:!1,isMovingDown:!1}}update(e){const t=Lt*this.speed;return this.moveState.isMovingDown&&(e.y+=t),this.moveState.isMovingTop&&(e.y-=t),this.moveState.isMovingRight&&(e.x+=t),this.moveState.isMovingLeft&&(e.x-=t),e}isMoving(){return Object.values(this.moveState).reduce(((e,t)=>e||t),!1)}}function Zt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Yt extends Jt{constructor(e){super(),Zt(this,"timeAfterLastSpriteUpdate",void 0),Zt(this,"sprites",void 0),this.sprites=e.sprites,this.timeAfterLastSpriteUpdate=0}update(e,t){this.timeAfterLastSpriteUpdate+=Lt;const i=this.shouldUpdateSprite();if(e&&i){const i=t.isMoving(),n=this.isCurrentSpriteIdle(e);e.sprite=i?n?this.sprites.run_0:this.getNextRunSprite(e):n?this.getNextIdleSprite(e):this.sprites.idle_0}return e&&(t.moveState.isMovingRight&&(e.shouldFlip=!1),t.moveState.isMovingLeft&&(e.shouldFlip=!0)),e}shouldUpdateSprite(){return this.timeAfterLastSpriteUpdate>5*Lt&&(this.timeAfterLastSpriteUpdate=0,!0)}isCurrentSpriteIdle(e){const t=e?.sprite;return t===this.sprites.idle_0||t===this.sprites.idle_1||t===this.sprites.idle_2||t===this.sprites.idle_3}getNextRunSprite(e){const t=e?.sprite;switch(t){case this.sprites.run_0:return this.sprites.run_1;case this.sprites.run_1:return this.sprites.run_2;case this.sprites.run_2:return this.sprites.run_3;case this.sprites.run_3:default:return this.sprites.run_0}}getNextIdleSprite(e){const t=e?.sprite;switch(t){case this.sprites.idle_0:return this.sprites.idle_1;case this.sprites.idle_1:return this.sprites.idle_2;case this.sprites.idle_2:return this.sprites.idle_3;case this.sprites.idle_3:default:return this.sprites.idle_0}}}function ei(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ti extends Jt{constructor(e){super(),ei(this,"currentRotation",0),ei(this,"maxAnimationStep",10),ei(this,"maxRotation",2.4)}update(e,t){if(e.active){const i=t.spriteConfig?.shouldFlip,n=t.geometry,{x:a}=t.position,{y:s}=t.position,{width:r}=n,{height:o}=n;let l=a+.55*r;i&&(l=a-.15*r);const c=s-.5*o;e.position.x=l,e.position.y=c,this.currentRotation+=this.maxRotation/this.maxAnimationStep;const u=e.geometry,h=new Mt(e.position.x,e.position.y+u.height);e.rotateAround(h,this.currentRotation),this.currentRotation>=this.maxRotation&&(this.currentRotation=0,e.attackCount+=1,e.active=!1,e.visible=!1)}return e}}class ii extends Vt{constructor(e){var t;super(e),(t="canCollide")in this?Object.defineProperty(this,t,{value:true,enumerable:!0,configurable:!0,writable:!0}):this[t]=true,this.init()}init(){}onCollide(){}}function ni(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ai extends Vt{constructor(e){super(e),ni(this,"canCollide",!0),ni(this,"active",void 0),ni(this,"damage",void 0),ni(this,"attackCount",void 0),this.damage=e.damage,this.active=!1,this.attackCount=0,this.init()}init(){}onCollide(){}}let si;!function(e){e.Ground="Ground",e.Wall="Wall",e.UI="UI"}(si||(si={}));const ri={1:si.Ground,2:si.Wall,3:si.UI},oi=e=>{let t=0;const i=Math.random();return i<e.left.chance?e.left:(t+=e.left.chance,i<t+e.right.chance?e.right:(t+=e.right.chance,i<t+e.down.chance?e.down:(t+=e.down.chance,i<t+e.top.chance?e.top:{name:"",chance:-1})))},li=(e,t,i,n)=>{const a=e;for(let e=t;e<t+n;e+=1)for(let t=i;t<i+n;t+=1)a[e][t]=1;return a};function ci(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ui={left:{name:"left",chance:.25},right:{name:"right",chance:.25},down:{name:"down",chance:.25},top:{name:"top",chance:.25}};class hi extends Vt{get health(){return this._health}set health(e){this._health=e,this._health<=0&&this.onDeath()}constructor(e){super(e),ci(this,"scene",void 0),ci(this,"canCollide",!0),ci(this,"speed",50),ci(this,"moveAnimation",void 0),ci(this,"prevPosition",void 0),ci(this,"spriteAnimation",void 0),ci(this,"enemySprites",void 0),ci(this,"prevRecievedDamage",void 0),ci(this,"maxHealth",void 0),ci(this,"_health",void 0),ci(this,"currentMoveStateCounter",0),ci(this,"maxMoveStateUpdate",30),this.scene=e.scene,this.maxHealth=e.maxHealth,this._health=this.maxHealth,this._createEnemySprites(e.image),this.init()}init(){this.moveAnimation=new Xt({speed:this.speed}),this.moveStateUpdateCondition(),this.spriteAnimation=new Yt({sprites:this.enemySprites})}updateState(){this.spriteConfig=this.spriteAnimation.update(this.spriteConfig,this.moveAnimation),this.prevPosition=this.position.copy(),this.moveStateUpdateCondition(),this.position=this.moveAnimation.update(this.position)}onCollide(e){e instanceof ii&&(this.position=Nt.getNewPositionAfterWallCollision(this,e,this.moveAnimation,this.prevPosition)),e instanceof gi&&(e.health-=.5),e instanceof ai&&e.active&&this.prevRecievedDamage!==e.attackCount&&(this.health-=e.damage,this.prevRecievedDamage=e.attackCount)}onDeath(){this.scene.remove(this),this.scene.objects.filter((e=>e instanceof hi)).length||Li.gameWinCallback()}moveStateUpdateCondition(){if(this.currentMoveStateCounter<this.maxMoveStateUpdate)return void(this.currentMoveStateCounter+=1);this.currentMoveStateCounter=0;const{moveState:e}=this.moveAnimation;switch(e.isMovingDown=!1,e.isMovingLeft=!1,e.isMovingRight=!1,e.isMovingTop=!1,oi(ui)){case ui.left:e.isMovingLeft=!0;break;case ui.right:e.isMovingRight=!0;break;case ui.down:e.isMovingDown=!0;break;case ui.top:e.isMovingTop=!0}}_createEnemySprites(e){this.enemySprites={idle_0:{sx:368,sy:80,sWidth:16,sHeight:16},idle_1:{sx:384,sy:80,sWidth:16,sHeight:16},idle_2:{sx:400,sy:80,sWidth:16,sHeight:16},idle_3:{sx:416,sy:80,sWidth:16,sHeight:16},run_0:{sx:432,sy:80,sWidth:16,sHeight:16},run_1:{sx:448,sy:80,sWidth:16,sHeight:16},run_2:{sx:464,sy:80,sWidth:16,sHeight:16},run_3:{sx:480,sy:80,sWidth:16,sHeight:16}},this.spriteConfig={image:e,sprite:this.enemySprites.idle_0,shouldFlip:!1}}}function di(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const mi=new class extends class{constructor(){var e,t;t=void 0,(e="_listeners")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,this._listeners=new Map}on(e,t){const i=this._listeners.get(e)||[];i.push(t),this._listeners.set(e,i)}off(e,t){const i=this._listeners.get(e);i&&this._listeners.set(e,i.filter((e=>e!==t)))}emit(e,...t){const i=this._listeners.get(e);i&&i.forEach((e=>{e(...t)}))}}{constructor(...e){super(...e),di(this,"_keyDownListener",void 0),di(this,"_keyUpListener",void 0),di(this,"_resizeListener",void 0)}init(){const e=this;this._keyDownListener=t=>{switch(t.key){case Pt.ArrowDown:e.emit(Tt.ArrowBottomDown);break;case Pt.ArrowLeft:e.emit(Tt.ArrowLeftDown);break;case Pt.ArrowRight:e.emit(Tt.ArrowRightDown);break;case Pt.ArrowUp:e.emit(Tt.ArrowTopDown);break;case Pt.Space:e.emit(Tt.SpaceDown)}},this._keyUpListener=t=>{switch(t.key){case Pt.ArrowDown:e.emit(Tt.ArrowBottomUp);break;case Pt.ArrowLeft:e.emit(Tt.ArrowLeftUp);break;case Pt.ArrowRight:e.emit(Tt.ArrowRightUp);break;case Pt.ArrowUp:e.emit(Tt.ArrowTopUp);break;case Pt.Space:e.emit(Tt.SpaceUp)}},this._resizeListener=t=>{e.emit(Tt.Resize)},window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),window.addEventListener("resize",this._resizeListener)}unsubscribe(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),window.removeEventListener("resize",this._resizeListener)}};function pi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class gi extends Vt{get health(){return this._health}set health(e){this._health=e,Li.playerUI.updateHealth(this._health),this._health<=0&&this.onDeath()}constructor(e){super(e),pi(this,"geometry",void 0),pi(this,"speed",150),pi(this,"moveAnimation",void 0),pi(this,"prevPosition",void 0),pi(this,"canCollide",!0),pi(this,"spriteAnimation",void 0),pi(this,"playerSprites",void 0),pi(this,"weapon",void 0),pi(this,"attackAnimation",void 0),pi(this,"maxHealth",void 0),pi(this,"_health",void 0),this.maxHealth=e.maxHealth,this._health=this.maxHealth,this._createPlayerSprites(e.image),this._updateWeaponState(),this.init()}init(){this.moveAnimation=new Xt({speed:this.speed}),this.moveStateUpdateCondition(),this.spriteAnimation=new Yt({sprites:this.playerSprites}),this.attackAnimation=new ti}updateState(){this.spriteConfig=this.spriteAnimation.update(this.spriteConfig,this.moveAnimation),this.weapon.spriteConfig&&(this.weapon.spriteConfig.shouldFlip=this.spriteConfig?.shouldFlip),this.prevPosition=this.position.copy(),this.position=this.moveAnimation.update(this.position),this.weapon=this.attackAnimation.update(this.weapon,this)}onCollide(e){(e instanceof ii||e instanceof hi)&&(this.position=Nt.getNewPositionAfterWallCollision(this,e,this.moveAnimation,this.prevPosition))}onDeath(){Li.gameOverCallback()}moveStateUpdateCondition(){const{moveState:e}=this.moveAnimation;mi.on(Tt.ArrowLeftDown,(()=>e.isMovingLeft=!0)),mi.on(Tt.ArrowBottomDown,(()=>e.isMovingDown=!0)),mi.on(Tt.ArrowTopDown,(()=>e.isMovingTop=!0)),mi.on(Tt.ArrowRightDown,(()=>e.isMovingRight=!0)),mi.on(Tt.ArrowLeftUp,(()=>e.isMovingLeft=!1)),mi.on(Tt.ArrowTopUp,(()=>e.isMovingTop=!1)),mi.on(Tt.ArrowBottomUp,(()=>e.isMovingDown=!1)),mi.on(Tt.ArrowRightUp,(()=>e.isMovingRight=!1))}_updateWeaponState(){mi.on(Tt.SpaceDown,(()=>{this.weapon.active=!0,this.weapon.visible=!0}))}_createPlayerSprites(e){this.playerSprites={idle_0:{sx:128,sy:107,sWidth:16,sHeight:21},idle_1:{sx:144,sy:107,sWidth:16,sHeight:21},idle_2:{sx:160,sy:107,sWidth:16,sHeight:21},idle_3:{sx:176,sy:107,sWidth:16,sHeight:21},run_0:{sx:192,sy:107,sWidth:16,sHeight:21},run_1:{sx:208,sy:107,sWidth:16,sHeight:21},run_2:{sx:224,sy:107,sWidth:16,sHeight:21},run_3:{sx:240,sy:107,sWidth:16,sHeight:21}},this.spriteConfig={image:e,sprite:this.playerSprites.idle_0,shouldFlip:!1}}}class yi extends Vt{constructor(e){super(e),this.init()}init(){}}function vi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class wi{get x(){return this.bindedObject?.position.x||0}get y(){return this.bindedObject?.position.y||0}constructor(e){vi(this,"bindedObject",void 0),vi(this,"size",void 0),this.size=e}bindObject(e){this.bindedObject=e}}var fi=i(670),bi=i.n(fi);function Ei(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Si={sx:288,sy:256,sWidth:16,sHeight:16},xi={sx:304,sy:256,sWidth:16,sHeight:16},Ci={sx:320,sy:256,sWidth:16,sHeight:16};class Oi extends Vt{constructor(e){super(e),Ei(this,"tileSetImage",void 0),Ei(this,"isHalf",void 0),Ei(this,"isEmpty",void 0),this.isHalf=Boolean(e.isHalf),this.isEmpty=Boolean(e.isEmpty),this.tileSetImage=e.tileSetImage,this.init()}init(){this.spriteConfig={image:this.tileSetImage,sprite:Si},this.isHalf&&(this.spriteConfig.sprite=xi),this.isEmpty&&(this.spriteConfig.sprite=Ci)}}function Ii(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ai{constructor(e){Ii(this,"canvas",void 0),Ii(this,"renderer",void 0),Ii(this,"camera",void 0),Ii(this,"scene",void 0),Ii(this,"health",void 0),Ii(this,"maxHealth",void 0),Ii(this,"score",void 0),Ii(this,"tileSetImage",void 0),this.canvas=e.canvas,this.canvas.style.position="absolute",this.canvas.height=window.innerHeight,this.canvas.width=window.innerWidth,this.maxHealth=e.maxHealth,this.tileSetImage=e.tileSetImage,this.init()}init(){this.renderer=new Dt({canvas:this.canvas,width:window.innerWidth,height:window.innerHeight}),this.camera=new wi(640);const e=new jt(0,0,0,0);this.scene=new Gt(e),this.updateHealth(this.maxHealth)}updateHealth(e){this.health=e;const t=[];for(let e=1;e<=this.maxHealth;e+=1){let i=!1,n=!1;e>this.health&&(e-this.health==.5?n=!0:i=!0);const a=new Ht(16,16),s=new Oi({geometry:a,tileSetImage:this.tileSetImage,isEmpty:i,isHalf:n});s.position.x=16*(e-1)+5,s.position.y=5,t.push(s)}this.scene.objects=this.scene.objects.filter((e=>e instanceof Oi)),this.scene.add(t)}updateScore(){}}function _i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Li=new class{constructor(){_i(this,"scene",void 0),_i(this,"camera",void 0),_i(this,"player",void 0),_i(this,"tileSetImage",void 0),_i(this,"level",void 0),_i(this,"playerUI",void 0),_i(this,"gameOverCallback",void 0),_i(this,"gameWinCallback",void 0);const e=N?null:new Image(512,512);e&&(e.src=bi(),this.tileSetImage=e)}composeLevel(e,t){this.gameOverCallback=e,this.gameWinCallback=t,this.camera=new wi(640);const i=new jt(0,0,0);this.scene=new Gt(i),this.level=(()=>{let e=new Array(40).fill(0).map((e=>new Array(40).fill(3)));const t={left:{name:"left",chance:0},right:{name:"right",chance:.8},down:{name:"down",chance:.2},top:{name:"top",chance:0}};let i=Math.round(37*Math.random()+1),n=1;for(;n+6<38;){let a=oi(t);a===t.right&&(i+12<38?(i+=6,e=li(e,n,i,6),t.left.chance=.45,t.right.chance=.45,t.down.chance=.1,t.top.chance=0):(a=t.down,t.left.chance=.9,t.right.chance=0,t.down.chance=.1,t.top.chance=0)),a===t.down&&(n+12<38?(n+=6,e=li(e,n,i,6),t.left.chance=.45,t.right.chance=.45):n+=6),a===t.left&&(i-6>1?(i-=6,e=li(e,n,i,6),t.left.chance=.45,t.right.chance=.45,t.down.chance=.1,t.top.chance=0):(a=t.down,t.right.chance=.9,t.left.chance=0,t.down.chance=.1,t.top.chance=0))}for(let t=0;t<e.length;t+=1)for(let i=0;i<e.length;i+=1)1===e[t][i]&&(3===e[t+1][i]&&(e[t+1][i]=2),3===e[t-1][i]&&(e[t-1][i]=2),3===e[t+1][i-1]&&(e[t+1][i-1]=2),3===e[t+1][i+1]&&(e[t+1][i+1]=2),3===e[t][i-1]&&(e[t][i-1]=2,e[t-1][i-1]=2),3===e[t][i+1]&&(e[t][i+1]=2,e[t-1][i+1]=2));return e})();const n=this._createWallsAndGroundFromLevel(this.level);this.scene.add(n),this.scene.addObjectWithPhysics(n.filter((e=>e instanceof ii)));const[a,s]=this._createPlayer(this.level);return this.player=a,this.scene.add([s,a]),this.scene.addObjectWithPhysics([s,a]),this.camera.bindObject(a),this._createEnemies(),[this.scene,this.camera]}composeUIScene(e){this.playerUI=new Ai({canvas:e,tileSetImage:this.tileSetImage,maxHealth:this.player.maxHealth})}getTilePositionFromCoordinates(e){const t=Math.floor(e.x/_t)*_t,i=Math.floor(e.y/_t)*_t;return new Mt(t,i)}_createWallsAndGroundFromLevel(e){const t=[];for(let i=0;i<e.length;i+=1)for(let n=0;n<e.length;n+=1){const a=e[i][n],s=new Mt(n*_t,i*_t);if(ri[a]===si.Ground){const e=new Ht(_t,_t),i=new jt(225,0,0),n=new yi({geometry:e,color:i});n.position=s;const a={sx:16,sy:64,sWidth:16,sHeight:16};n.spriteConfig={image:this.tileSetImage,sprite:a},t.push(n)}if(ri[a]===si.Wall){const e=new Ht(_t,_t),i=new jt(0,225,0),n=new ii({geometry:e,color:i});n.position=s;const a={sx:16,sy:16,sWidth:16,sHeight:16};n.spriteConfig={image:this.tileSetImage,sprite:a},t.push(n)}}return t}_createPlayer(e){const t=new Ht(16,21),i=new gi({geometry:t,image:this.tileSetImage,maxHealth:6}),n=(e=>{for(let t=0;t<e.length;t+=1)for(let i=0;i<e.length;i+=1){const n=e[t][i];if(ri[n]===si.Ground)return new Mt(i*_t,t*_t)}})(e);if(!n)throw new Error("Уровень сгенерирован с ошибкой");i.position=n;const a=new Ht(10,21),s=new ai({geometry:a,damage:1});return s.spriteConfig={image:this.tileSetImage,sprite:{sx:323,sy:26,sWidth:10,sHeight:21}},s.visible=!1,i.weapon=s,[i,s]}_createEnemies(){const e=this._createEnemy(this.scene,this.level);this.scene.add(e),this.scene.addObjectWithPhysics(e);const t=this._createEnemy(this.scene,this.level);this.scene.add(t),this.scene.addObjectWithPhysics(t);const i=this._createEnemy(this.scene,this.level);this.scene.add(i),this.scene.addObjectWithPhysics(i)}_createEnemy(e,t){const i=new Ht(_t,_t),n=new hi({scene:e,geometry:i,color:new jt(0,0,255),image:this.tileSetImage,maxHealth:1}),a=(e=>{for(let t=e.length-1;t>=0;t-=1)for(let i=e.length-1;i>=0;i-=1){const n=e[t][i];if(ri[n]===si.Ground)return new Mt(i*_t,t*_t)}})(t);if(!a)throw new Error("Уровень сгенерирован с ошибкой");return n.position=a,n}};function Ti(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Pi{constructor(){Ti(this,"canvas",void 0),Ti(this,"uiCanvas",void 0),Ti(this,"renderer",void 0),Ti(this,"animationNumber",void 0),Ti(this,"scene",void 0),Ti(this,"camera",void 0),Ti(this,"gameOverCallback",void 0),Ti(this,"gameWinCallback",void 0)}init(e){this.canvas=e.canvas,this.uiCanvas=e.uiCanvas,this.gameOverCallback=e.gameOverCallback,this.gameWinCallback=e.gameWinCallback,this.renderer=new Dt({canvas:this.canvas,width:window.innerWidth,height:window.innerHeight}),[this.scene,this.camera]=Li.composeLevel(this.gameOverCallback,this.gameWinCallback),this.uiCanvas&&Li.composeUIScene(this.uiCanvas),mi.init(),mi.on(Tt.Resize,this._onResize.bind(this)),this.startAnimataion()}startAnimataion(){let e=0,t=performance.now();const i=()=>{this.animationNumber=requestAnimationFrame((()=>i()));const n=performance.now();for(e+=Math.min(1,(n-t)/1e3);e>Lt;)e-=Lt,this.renderer.prerender(this.scene);t=n,this.renderer.render(this.scene,this.camera),Li.playerUI.renderer.render(Li.playerUI.scene,Li.playerUI.camera)};i()}stopAnimation(){this.animationNumber&&(cancelAnimationFrame(this.animationNumber),this.animationNumber=void 0)}_onResize(){this.canvas&&this.animationNumber&&(this.canvas.height=window.innerHeight,this.canvas.width=window.innerWidth,this.uiCanvas&&(this.uiCanvas.height=window.innerHeight,this.uiCanvas.width=window.innerWidth))}destroy(){this.stopAnimation(),mi.unsubscribe()}}const ki=()=>{document.documentElement.requestPointerLock()},Ni=()=>{document.exitPointerLock()},Ri=()=>{document.fullscreenElement&&document.exitFullscreen()},Di=()=>{document.fullscreenElement||document.documentElement.requestFullscreen()},Ui="eFlcKTx78Wlv2EtRSPio",{Title:ji}=I.Typography,Fi=({isActive:e,isPaused:t,isGameOver:i,isGameWin:n,onClose:a,onStart:s,onResume:r})=>v().createElement(I.Modal,{title:"Меню",visible:e,footer:null,closable:!1},v().createElement("div",{className:"VJBHhg7XFDtxeSNUAZDw"},i&&v().createElement(ji,{className:Ui,level:3},"Потрачено!"),n&&v().createElement(ji,{className:Ui,level:3},"Победа!"),v().createElement(I.Button,{type:"primary",onClick:t?r:s},t?"Продолжить":"Начать "+(i||n?"заново":"игру")),v().createElement(I.Button,{type:"primary",onClick:a},"Вернуться на главную"))),qi=()=>{const{isActive:e,isPaused:t,canvasRef:i,uiCanvasRef:n,onStart:a,onResume:s,onClose:o,onUnmount:l,setUpPauseButton:c,isGameOver:u,isGameWin:h}=(()=>{const[e,t]=(0,y.useState)(!0),[i,n]=(0,y.useState)(!1),[a,s]=(0,y.useState)(!1),[o,l]=(0,y.useState)(!1),[c]=(0,y.useState)(new Pi),u=v().useRef(null),h=v().useRef(null),d=(0,f.useHistory)(),m=_e((e=>e.profile.data),b.shallowEqual),p=(0,y.useCallback)((()=>{const e={login:m.login,[pt]:Math.round(200*Math.random())};gt.createLeaderBoardRecord(e)}),[]),g=(0,y.useCallback)((e=>{"q"===e.key&&(t(!0),l(!0),c.stopAnimation(),Ni()),"f"===e.key&&(document.fullscreenElement?Ri():Di())}),[]),w=(0,y.useCallback)((()=>{t(!0),n(!0),c.destroy(),Ni(),p()}),[]),E=(0,y.useCallback)((()=>{t(!0),s(!0),c.destroy(),Ni(),p()}),[]),S=(0,y.useCallback)((()=>{document.addEventListener("keydown",g)}),[]),x=(0,y.useCallback)((()=>{t(!1),Ri(),d.push(r.main.path)}),[]),C=(0,y.useCallback)((()=>{c.init({canvas:u.current,uiCanvas:h.current,gameOverCallback:w,gameWinCallback:E}),n(!1),s(!1),l(!1),t(!1),ki(),Di()}),[]),O=(0,y.useCallback)((()=>{c.startAnimataion(),l(!1),t(!1),ki()}),[]),I=(0,y.useCallback)((()=>{c.destroy(),document.removeEventListener("keydown",g)}),[]);return{isActive:e,isPaused:o,canvasRef:u,uiCanvasRef:h,onStart:C,onResume:O,onClose:x,onUnmount:I,setUpPauseButton:S,isGameOver:i,isGameWin:a}})();var d;return fe((()=>{c()})),d=()=>{l()},(0,y.useEffect)((()=>()=>{d()}),[]),v().createElement(v().Fragment,null,v().createElement(xe,{title:"Game",description:"Game page"}),v().createElement("div",{className:"KQGV7dUqbgjYs1ZwpxXx"},v().createElement("canvas",{ref:i}),v().createElement("canvas",{ref:n}),v().createElement(Fi,{isActive:e,onClose:o,onStart:a,isPaused:t,isGameOver:u,isGameWin:h,onResume:s})))},Bi={title:"wN3ZAMOwZkdEOLnck1VB",info:"WgBzMCi6qYIjWHRWiYJo",notFound:"Au51wDy14LIeKsXdlStJ",container:"aNybNIFFW5NPE8XGbE8a",errorContainer:"pRiz7GMS75rLbl0hQ3MK",back:"F5BSP_DuF2JWJpELV9l9"},Mi=()=>{const{container:e,errorContainer:t,title:i,info:n,back:a,notFound:s}=Bi;return v().createElement(Ee,null,v().createElement("div",{className:e},v().createElement("div",{className:t},v().createElement(I.Typography,{className:i},"Вы сейчас оффлайн"),v().createElement(I.Typography,{className:n},"Попробуйте зайти позже"),v().createElement(f.Link,{to:"/",className:a},"Вернуться")),v().createElement("div",{className:s})))},Wi=({author:e,message:t})=>v().createElement(I.Comment,{className:"TspRTE2G39H6tAirzKZs",author:v().createElement("a",null,e??"author"),content:v().createElement("p",null,t??"Say what?")}),{TextArea:Hi}=I.Input,zi=()=>{const[e,t]=(0,y.useState)(""),i=(0,y.useCallback)((e=>t(e.target.value)),[]),n=(0,y.useCallback)((()=>console.log(e)),[e]);return v().createElement(v().Fragment,null,v().createElement("div",{className:"bTNmpK1ju_yi_nGhJ8V7"},v().createElement(Hi,{maxLength:100,rows:3,onChange:i,value:e})),v().createElement("div",{className:"Tn1PaCwUlNzlPDXni40j"},v().createElement(Ae,{type:"primary",onClick:n},"Отправить")))},Gi=e=>({type:te,payload:{isLoading:e}}),{Title:Ki,Text:$i}=I.Typography,Vi=()=>{const{topic:e,isLoading:t}=(()=>{const e=(0,b.useDispatch)(),{data:t,isLoading:i}=_e((e=>e.topic),b.shallowEqual),{pathname:n}=(0,f.useLocation)(),a=n.split("/").slice(-1)[0];return fe((()=>{e((e=>async(t,i)=>{t(Gi(!0));try{const i=await ut.getTopic(e);i&&t((e=>({type:ee,payload:{data:e}}))(i)),t(Gi(!1))}catch(e){t(Gi(!1))}})(Number(a)))})),{topic:t,isLoading:i}})(),{title:i,body:n}=e;return v().createElement(Be,{isSpinning:t},v().createElement(Ee,null,v().createElement(xe,{title:"Topic",description:"About game"}),v().createElement(qe,{currentPath:r.topic.path}),v().createElement("div",{className:"VRShYKvDw5s7uMOjoJ0w"},v().createElement(Ki,{level:2},i),v().createElement($i,null,n),v().createElement("div",{className:"rEOOn71v_anhyYGzSuIJ"},v().createElement(Wi,null),v().createElement(Wi,null),v().createElement(Wi,null)),v().createElement(zi,null))))},Ji=e=>v().createElement(I.Input,e);let Qi;!function(e){e.Title="title",e.Body="body"}(Qi||(Qi={}));const{TextArea:Xi}=I.Input,Zi=()=>{const{isLoading:e,onFinish:t,onFinishFailed:i,currentPath:n,submitLabel:a,titleLabel:s}=(()=>{const e=(0,f.useHistory)(),t=(0,b.useDispatch)(),i=_e((e=>e.topic.isLoading)),{pathname:n}=(0,f.useLocation)(),a=n.split("/").slice(-1)[0],s=!isNaN(Number(a)),o=s?"Редактировать":"Создать",l=s?"Редактирование темы":"Создание темы";console.log(s);const c=(0,y.useCallback)((async i=>{t(s?((e,t)=>async(i,n)=>{i(Gi(!0));try{await ut.updateTopic(e,t)||i(Gi(!1))}catch(e){i(Gi(!1))}})(Number(a),i):((e,t)=>async(i,n)=>{i(Gi(!0));try{await ut.createTopic(e)?t.push(r.forum.path):i(Gi(!1))}catch(e){i(Gi(!1))}})(i,e))}),[]);return{currentPath:r.topicEdit.path,onFinish:c,onFinishFailed:e=>console.log("Failed:",e),isLoading:i,submitLabel:o,titleLabel:l}})();return v().createElement(Be,{isSpinning:e},v().createElement(Ee,null,v().createElement(xe,{title:"Topic",description:"About game"}),v().createElement(qe,{currentPath:n}),v().createElement("div",{className:"tVA28iwOv6hGtnPiEqJV"},v().createElement(I.Typography,{className:"bsDM8hjmhcRnrixWOtoO"},s),v().createElement(I.Form,{name:"topicCreate",onFinish:t,onFinishFailed:()=>i,layout:"vertical"},v().createElement(I.Form.Item,{name:Qi.Title,rules:[{required:!0,message:"Введите заголовок топика"}]},v().createElement(Ji,{placeholder:"заголовок",prefix:v().createElement(be.RightOutlined,null)})),v().createElement(I.Form.Item,{name:Qi.Body,rules:[{required:!0,message:"Введите описание топика"}]},v().createElement(Xi,{maxLength:100,rows:6,placeholder:"описание"})),v().createElement(I.Form.Item,null,v().createElement(I.Button,{block:!0,type:"primary",htmlType:"submit"},a))))))};function Yi(){return Yi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Yi.apply(this,arguments)}const en=({component:e,...t})=>{const i=e,n=D(),a=_e((e=>e.auth.isSignedIn)),s=_e((e=>e.auth.isSignedInOAuth)),r=n||a||s;return v().createElement(f.Route,Yi({},t,{render:()=>r?v().createElement(i,null):v().createElement(Ct,{status:"403"})}))};function tn(){return tn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},tn.apply(this,arguments)}const nn=({component:e,...t})=>{const i=e,n=D(),a=_e((e=>e.auth.isSignedIn)),s=_e((e=>e.auth.isSignedInOAuth)),o=n||a||s;return v().createElement(f.Route,tn({},t,{render:()=>o?v().createElement(f.Redirect,{to:r.main.path}):v().createElement(i,null)}))},an=()=>{const{search:e}=(0,f.useLocation)(),t=(0,b.useDispatch)(),i=(0,f.useHistory)();return fe((()=>{const n=new URLSearchParams(e).get("code");n&&we.signUpWithYandex(n).then((()=>{t((e=>async(t,i)=>{t({type:G}),j(!0),e.push(r.main.path)})(i)),t(W())}))})),v().createElement(f.Switch,null,v().createElement(f.Redirect,{exact:!0,from:"/",to:r.signIn.path}),v().createElement(nn,{path:r.signIn.path,component:Ke}),v().createElement(nn,{path:r.signUp.path,component:Ve}),v().createElement(en,{path:r.main.path,component:Xe}),v().createElement(en,{path:r.profile.path,component:ot}),v().createElement(en,{exact:!0,path:r.forum.path,component:dt}),v().createElement(en,{path:r.topic.path,component:Vi}),v().createElement(en,{exact:!0,path:r.topicEdit.path,component:Zi}),v().createElement(en,{path:r.leaderboard.path,component:Et}),v().createElement(f.Route,{path:r.about.path,component:mt}),v().createElement(en,{path:r.game.path,component:qi}),v().createElement(f.Route,{path:"/error",component:Ct}),v().createElement(f.Route,{path:"/offline",component:Mi}))},sn=()=>v().createElement(an,null),{Title:rn}=I.Typography,on=({onClose:e})=>v().createElement(v().Fragment,null,v().createElement(rn,{className:"UAUK2yU1qb5KDEJM4sbz",level:2},"Нет интернет соединения"),v().createElement(I.Button,{type:"primary",onClick:()=>e()},"Закрыть")),ln=N?null:navigator?.serviceWorker,cn=()=>{const e=(0,b.useDispatch)(),{onClose:t,isActive:i}=(()=>{const[e,t]=(0,y.useState)(!1),i=(0,y.useCallback)((()=>{t(!1)}),[]);return(0,y.useEffect)((()=>{ln&&window.addEventListener("load",(()=>{ln.register("./sw.js").then((e=>{console.log("ServiceWorker registration successful ",e.scope)})).then((()=>{ln.addEventListener("message",(({data:e})=>{"FORBIDDEN_METHOD"===e&&t(!0)}))})).catch((e=>{console.log("ServiceWorker registration failed: ",e)}))}),{once:!0})}),[]),{isActive:e,onClose:i}})(),n=_e((e=>e.profile.data.id));return(0,y.useEffect)((()=>{e((async(e,t)=>{const i=F(),n=(await Pe.getTheme(i))?.theme||ke;e(De(n)),Re(n)}))}),[n]),v().createElement("div",{className:"d6rBLli3BagIoSgKy2ws"},v().createElement(me,{isActive:i,title:"Ошибка"},v().createElement(on,{onClose:t})),v().createElement(de,null,v().createElement(sn,null)))};let un;!function(e){e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Redirect=302]="Redirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.ServerError=500]="ServerError"}(un||(un={}));const hn=(0,x.createStore)(ce,ue,(0,x.compose)((0,x.applyMiddleware)(O()),!N&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__():e=>e)),dn=t().Router(),mn=(pn=r,Object.values(pn).reduce(((e,t)=>e.concat([t.path])),[]));var pn;mn.push("/"),dn.get(mn,g,((e,t,i)=>{const n=e.url,a=e.get("Host");let s="https";a?.startsWith("localhost")&&(s="http");const r=`${s}://${a}`;e.cookies.uuid&&e.cookies.authCookie?hn.dispatch(Q()):hn.dispatch(X());const o=v().createElement(b.Provider,{store:hn},v().createElement(f.StaticRouter,{location:n},v().createElement(cn,null))),l=(0,w.renderToString)(o),c=hn.getState(),u=S().renderStatic();t.status(un.OK).send(((e,t,i,n={})=>`\n        <!DOCTYPE html>\n            <html lang="en">\n                <head>\n                    <meta charset="UTF-8">\n                    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n                    <link rel="preconnect" href="https://fonts.googleapis.com">\n                    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>\n                    <link rel="stylesheet" href="${e}/main.css"> \n                    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">\n                    ${i.title.toString()}\n                    ${i.meta.toString()}\n                </head>\n\n                <body>\n                    <div id="root">${t}</div>\n                    <script>\n                        window.__INITIAL_STATE__ = ${JSON.stringify(n)}\n                    <\/script>\n                    <script type="module" src="${e}/bundle.js"><\/script>\n                </body>\n        </html>\n    `)(r,l,u,c)),t.end()})),dn.get("/*",((e,t,i)=>{t.redirect("/")}));const gn=require("body-parser");var yn=i.n(gn);const vn=(e,t,i)=>{e.cookies.uuid&&e.cookies.authCookie?i():t.status(un.Unauthorized).send({message:"Пользователь не авторизован"})},wn=require("sequelize"),fn=require("sequelize-typescript");var bn,En,Sn,xn,Cn,On,In,An,_n,Ln,Tn,Pn,kn,Nn,Rn,Dn,Un,jn;function Fn(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function qn(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}let Bn=(bn=(0,fn.Table)({timestamps:!0,createdAt:"created_at",updatedAt:!1,tableName:"topics"}),En=(0,fn.Column)(fn.DataType.INTEGER),Sn=(0,fn.Length)({max:512}),xn=(0,fn.AllowNull)(!1),Cn=(0,fn.Column)(fn.DataType.STRING),On=(0,fn.AllowNull)(!1),In=(0,fn.Column)(fn.DataType.STRING),An=(0,fn.AllowNull)(!0),_n=(0,fn.Column)(fn.DataType.INTEGER),Ln=(0,fn.AllowNull)(!0),Tn=(0,fn.Column)(fn.DataType.INTEGER),bn((kn=class extends fn.Model{constructor(...e){super(...e),Fn(this,"id",Nn,this),Fn(this,"title",Rn,this),Fn(this,"body",Dn,this),Fn(this,"user_id",Un,this),Fn(this,"comments_count",jn,this)}},Nn=qn(kn.prototype,"id",[fn.AutoIncrement,fn.PrimaryKey,En],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rn=qn(kn.prototype,"title",[Sn,xn,Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=qn(kn.prototype,"body",[On,In],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Un=qn(kn.prototype,"user_id",[An,_n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jn=qn(kn.prototype,"comments_count",[Ln,Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=kn))||Pn);const Mn=e=>Bn.findOne({where:{id:e}}),Wn=e=>function(t,i,n){const a=n.value;return n.value=function(){const t=arguments,i=async()=>{try{await a.apply(this,t)}catch(i){e.call(this,i,t[1])}};i()},n};var Hn;function zn(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}const Gn=Wn(((e,t)=>e instanceof wn.ValidationError?t.status(un.BadRequest).send({message:"Неверный формат данных"}):t.status(un.ServerError).send({message:"Ошибка сервера"})));let Kn=(Hn=class{async get(e,t){const i=await Bn.findAll();return i&&i.length?t.status(un.OK).send(i):t.status(un.BadRequest).send({message:"Топики отсутствуют"})}async getTopic(e,t){const i=Number(e.params.id),n=await Mn(i);return n?t.status(un.OK).send(n):t.status(un.BadRequest).send({message:"Топики отсутствуют"})}async add(e,t){const i=await(e=>{const t={title:e?.title,body:e?.body,user_id:e?.user_id};return Bn.create(t)})(e.body);return i?t.status(un.Created).send(i):t.status(un.BadRequest).send({message:"Ошибка добавления топика"})}async update(e,t){const i=Number(e.params.id),n=await((e,t)=>{const i={};return t?.title&&(i.title=t.title),t?.body&&(i.body=t.body),t?.user_id&&(i.user_id=t.user_id),Bn.update(i,{where:{id:e}})})(i,e.body);if(!n[0])return t.status(un.BadRequest).send({message:"Ошибка изменения топика"});const a=await Mn(i);return t.status(un.OK).send(a)}async delete(e,t){const i=Number(e.params.id),n=await(e=>Bn.destroy({where:{id:e}}))(i);return n?t.status(un.OK).sendStatus(un.OK):t.status(un.BadRequest).send({message:"Ошибка удаления топика"})}},zn(Hn.prototype,"get",[Gn],Object.getOwnPropertyDescriptor(Hn.prototype,"get"),Hn.prototype),zn(Hn.prototype,"getTopic",[Gn],Object.getOwnPropertyDescriptor(Hn.prototype,"getTopic"),Hn.prototype),zn(Hn.prototype,"add",[Gn],Object.getOwnPropertyDescriptor(Hn.prototype,"add"),Hn.prototype),zn(Hn.prototype,"update",[Gn],Object.getOwnPropertyDescriptor(Hn.prototype,"update"),Hn.prototype),zn(Hn.prototype,"delete",[Gn],Object.getOwnPropertyDescriptor(Hn.prototype,"delete"),Hn.prototype),Hn);const $n=new Kn;var Vn,Jn,Qn,Xn,Zn,Yn,ea,ta,ia,na,aa;function sa(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function ra(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}let oa=(Vn=(0,fn.Table)({timestamps:!1,tableName:"themes"}),Jn=(0,fn.Column)(fn.DataType.INTEGER),Qn=(0,fn.AllowNull)(!0),Xn=(0,fn.Column)(fn.DataType.STRING),Zn=(0,fn.AllowNull)(!0),Yn=(0,fn.Column)(fn.DataType.INTEGER),Vn((ta=class extends fn.Model{constructor(...e){super(...e),sa(this,"id",ia,this),sa(this,"theme",na,this),sa(this,"user_id",aa,this)}},ia=ra(ta.prototype,"id",[fn.AutoIncrement,fn.PrimaryKey,Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),na=ra(ta.prototype,"theme",[Qn,Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa=ra(ta.prototype,"user_id",[Zn,Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea=ta))||ea);const la=e=>oa.findOne({where:{user_id:e}}),ca=e=>oa.create(e);var ua;function ha(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}const da=Wn(((e,t)=>(console.log(e),e instanceof wn.ValidationError?t.status(un.BadRequest).send({message:"Неверный формат данных"}):t.status(un.ServerError).send({message:"Ошибка сервера"})))),ma=new(ha((ua=class{async get(e,t){const i=Number(e.params.id),n=await la(i);if(!n){const e=await ca({user_id:i,theme:"light"});return e?t.status(un.OK).send(e):t.status(un.BadRequest).send({message:"Ошибка сохранения темы"})}return t.status(un.OK).send(n)}async update(e,t){const i=Number(e.params.id);if(!await la(i)){const n=await ca({user_id:i,theme:e.body});return n?t.status(un.OK).send(n):t.status(un.BadRequest).send({message:"Ошибка сохранения темы"})}const n=await((e,t)=>{const i={theme:t.theme,user_id:e};return oa.update(i,{where:{user_id:e}})})(i,e.body);if(!n[0])return t.status(un.BadRequest).send({message:"Ошибка изменения темы"});const a=await la(i);return t.status(un.OK).send(a)}async add(e,t){const i=await ca(e.body);return i?t.status(un.OK).send(i):t.status(un.BadRequest).send({message:"Ошибка сохранения темы"})}}).prototype,"get",[da],Object.getOwnPropertyDescriptor(ua.prototype,"get"),ua.prototype),ha(ua.prototype,"update",[da],Object.getOwnPropertyDescriptor(ua.prototype,"update"),ua.prototype),ha(ua.prototype,"add",[da],Object.getOwnPropertyDescriptor(ua.prototype,"add"),ua.prototype),ua),pa=t().Router(),ga=[yn().json(),vn];pa.get("/api/local/topics",...ga,$n.get),pa.get("/api/local/topics/:id",...ga,$n.getTopic),pa.post("/api/local/topics",...ga,$n.add),pa.put("/api/local/topics/:id",...ga,$n.update),pa.delete("/api/local/topics/:id",...ga,$n.delete),pa.get("/api/local/themes/:id",...ga,ma.get),pa.put("/api/local/themes/:id",...ga,ma.update),pa.post("/api/local/themes",...ga,ma.add);const ya=t().Router();ya.all("/api/v2/*",m,vn);const va=t()();va.use(t().static(`${__dirname}`)),va.use(s()()),va.use(pa),va.use(ya),va.use(dn);const wa=process.env.PORT||3e3;(()=>{const e={host:process.env.DB_HOST,port:Number(process.env.DB_PORT)||5432,username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,dialect:"postgres"},t=new fn.Sequelize(e);return t.addModels([Bn,oa]),t})()?.authenticate().then((()=>console.log("db connected"))).catch((e=>console.error("db error: ",e))),va.listen(wa,(()=>{console.log(`Server started on port ${wa}`)}))})(),module.exports=n})();
//# sourceMappingURL=server.js.map